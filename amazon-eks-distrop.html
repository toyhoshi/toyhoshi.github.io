<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Amazon EKS Distro - www.clouday.dev</title><meta name="description" content=" Amazon EKS Distro (EKS-D) is a Kubernetes distribution based on and used by Amazon Elastic Kubernetes Service (EKS) to create reliable and secure Kubernetes clusters. With&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.clouday.dev/amazon-eks-distrop.html"><link rel="alternate" type="application/atom+xml" href="https://www.clouday.dev/feed.xml"><link rel="alternate" type="application/json" href="https://www.clouday.dev/feed.json"><meta property="og:title" content="Amazon EKS Distro"><meta property="og:site_name" content="www.clouday.dev"><meta property="og:description" content=" Amazon EKS Distro (EKS-D) is a Kubernetes distribution based on and used by Amazon Elastic Kubernetes Service (EKS) to create reliable and secure Kubernetes clusters. With&hellip;"><meta property="og:url" content="https://www.clouday.dev/amazon-eks-distrop.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://www.clouday.dev/media/website/favicon.ico" type="image/x-icon"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Dosis:400,600&amp;display=swap" rel="stylesheet"><style>:root{--primary-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--secondary-font:'Dosis',sans-serif}</style><link rel="stylesheet" href="https://www.clouday.dev/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://www.clouday.dev/assets/css/style.css?v=c5595450718e9b8706c1d0ae208d0265"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.clouday.dev/amazon-eks-distrop.html"},"headline":"Amazon EKS Distro","datePublished":"2021-10-30T15:20","dateModified":"2022-01-29T16:10","description":" Amazon EKS Distro (EKS-D) is a Kubernetes distribution based on and used by Amazon Elastic Kubernetes Service (EKS) to create reliable and secure Kubernetes clusters. With&hellip;","author":{"@type":"Person","name":"Toyhoshi"},"publisher":{"@type":"Organization","name":"Toyhoshi"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://www.clouday.dev/"><strong>www.clouday.dev</strong></a><ul class="icons"><li><a href="https://twitter.com/toyhoshi" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li><li><a href="https://www.linkedin.com/in/marcovaragnolo" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li></ul></header><article class="post"><header class="main post__header"><time datetime="2021-10-30T15:20" class="post__date">Oct 30, 2021</time><h1>Amazon EKS Distro</h1></header><div class="post__inner post__entry"><p><img loading="lazy" src="https://images.unsplash.com/photo-1433840496881-cbd845929862?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1000&amp;q=80" data-is-external-image="true" alt="beam design-printed paper on desk"></p><p>Amazon <strong>EKS Distro</strong> (EKS-D) is a Kubernetes distribution based on and used by Amazon Elastic Kubernetes Service (EKS) to create reliable and secure Kubernetes clusters. With EKS-D, you can rely on the same versions of Kubernetes and its dependencies deployed by Amazon EKS. This includes the latest upstream updates, as well as extended security patching support. EKS-D follows the same Kubernetes version release cycle as Amazon EKS, and we provide the bits here. EKS-D provides the same software that has enabled tens of thousands of Kubernetes clusters on Amazon EKS.</p><p>What is the difference between EKS (the AWS Kubernetes cloud service) and EKS-D? The main difference is in how they are managed. EKS is a fully managed Kubernetes platform, while EKS-D is available to install and manage yourself. You can run EKS-D on-premises, in a cloud, or on your own systems. EKS-D provides a path to having essentially the same Amazon EKS Kubernetes distribution running wherever you need to run it.</p><p>Once EKS-D is running, you are responsible for managing and upgrading it yourself. For end users, however, running applications is the same as with EKS since the two support the same API versions and same set of components.</p><p><img loading="lazy" src="https://d2908q01vomqb2.cloudfront.net/ca3512f4dfa95a03169c5a670a4c91a19b3077b4/2020/11/30/hausenblas_options-1000x.png" data-is-external-image="true" alt="spectrum of EKS-based solutions options"></p><h2> </h2><h2 id="project-tenets-unless-you-know-better-ones">Project Tenets (unless you know better ones)</h2><p>The tenets of the EKS Distro (EKS-D) project are:</p><ol><li><strong>The Source</strong>: The goal of the EKS Distro is to be the Kubernetes source for EKS and EKS Anywhere</li><li><strong>Simple</strong>: Make using a Kubernetes distribution simple and boring (reliable and secure)</li><li><strong>Opinionated Modularity</strong>: Provide opinionated defaults about the best components to include with Kubernetes but give customers the ability to swap them out</li><li><strong>Open</strong>: Provide open source tooling backed, validated and maintained by Amazon</li><li><strong>Ubiquitous</strong>: Enable customers and partners to integrate a Kubernetes distribution in the most common tooling (Kubernetes installers and distributions, infrastructure as code, and more)</li><li><strong>Stand Alone</strong>: Provided for use anywhere without AWS dependencies</li><li><strong>Better with AWS</strong>: Enable AWS customers to adopt additional AWS services easily</li></ol><h2> </h2><h2>Getting started with EKS-D</h2><p>There are a lot of tools that are providing install methods as well integrations with EKS Distro, here we are going to describe how to use Kubernetes in Docker (KinD) to run EKS-D on your local machine. KinD, like Minikube and Microk8s, is way to host Kubernetes on your local machine except it doesn’t require additional drivers or a virtual machine.</p><p id="7000" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">The first step involves creating a fork of the <a class="ck ir" href="https://github.com/kbst/kind-eks-d" rel="noopener ugc nofollow" target="_blank">kbst/kind</a> project from Kubestack. Once the project has been forked, update the <code class="is it iu iv iw b">Makefile</code> in the root directory with the environment variables, e.g. the <code class="is it iu iv iw b">RELEASE_BRANCH</code>, <code class="is it iu iv iw b">VERSION</code>, and <code class="is it iu iv iw b">SOURCE_URL</code> of the build you want to use.</p><pre class="ix iy iz ja jb jc gw bt"><span id="2714" class="fc jd je ef iw b jf jg jh s ji" data-selectable-paragraph="">RELEASE_BRANCH = 1-20<br>VERSION := v$(subst -,.,$(RELEASE_BRANCH)).4<br>SOURCE_URL = <a class="ck ir" href="https://distro.eks.amazonaws.com/kubernetes-$%7BRELEASE_BRANCH%7D/releases/1/artifacts/kubernetes/$%7BVERSION%7D/kubernetes-src.tar.gz" rel="noopener ugc nofollow" target="_blank">https://distro.eks.amazonaws.com/kubernetes-${RELEASE_BRANCH}/releases/1/artifacts/kubernetes/${VERSION}/kubernetes-src.tar.gz</a><br>GIT_SHA := $(shell echo `git rev-parse --verify HEAD^{commit}`)<br>IMAGE_NAME = public.ecr.aws/jicowan/kind-eks-d<br>TEST_IMAGE = ${IMAGE_NAME}:${GIT_SHA}</span></pre><p id="da47" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">In this example, I am using Kubernetes v1.20.4. I am also pushing the resulting container image to ECR public. You can find a list of the available releases at <a class="ck ir" href="https://distro.eks.amazonaws.com/#releases" rel="noopener ugc nofollow" target="_blank">https://distro.eks.amazonaws.com/#releases</a>. To get the <code class="is it iu iv iw b">SOURCE_URL</code> for a release, download the release manifest and run the following <code class="is it iu iv iw b">yq</code> query:</p><pre class="ix iy iz ja jb jc gw bt"><span id="3b56" class="fc jd je ef iw b jf jg jh s ji" data-selectable-paragraph="">yq eval '.status.components.[] | select(.name="kubernetes") | .assets.[] | select(.name=="kubernetes-src.tar.gz")' ./kubernetes-1-20-eks-1.yaml</span></pre><p id="dd79" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">The output should looks similar to this:</p><pre class="ix iy iz ja jb jc gw bt"><span id="e943" class="fc jd je ef iw b jf jg jh s ji" data-selectable-paragraph="">archive:<br>  sha256: 7b642868c905e41a93beded9968d2c48daef7ecd57815bf0f83ca1337e1f6176<br>  sha512: 095e57e905a041963689ff9b2d1de30dd6f0344530253cccd4e3d91985091cc37564b95f45c1ed160129306d06f5d2670feb457cbb01e274f5a0c0f3c724f834<br>  uri: <a class="ck ir" href="https://distro.eks.amazonaws.com/kubernetes-1-20/releases/1/artifacts/kubernetes/v1.20.4/kubernetes-src.tar.gz" rel="noopener ugc nofollow" target="_blank">https://distro.eks.amazonaws.com/kubernetes-1-20/releases/1/artifacts/kubernetes/v1.20.4/kubernetes-src.tar.gz</a><br>description: Kubernetes source tarball<br>name: kubernetes-src.tar.gz<br>type: Archive</span></pre><p id="4120" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">Verify that the <code class="is it iu iv iw b">SOURCE_URL</code> matches the URI in the output from <code class="is it iu iv iw b"><a class="ck ir" href="https://mikefarah.gitbook.io/yq/" rel="noopener ugc nofollow" target="_blank">yq</a></code>. Be sure to leave the <code class="is it iu iv iw b">RELEASE_BRANCH</code> and <code class="is it iu iv iw b">VERSION</code> variables intact as they will be populated by the values you specified earlier.</p><p id="4b38" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">If, like me, you want to push the image the your own registry, you will need to update the <code class="is it iu iv iw b">main.yml</code> file under GitHub actions. As I am pushing the resulting image to ECR, I need to update Docker login section with environment variables for my AWS access key ID and secret key. GitHub actions will use these secrets to authenticate to ECR public.</p><pre class="ix iy iz ja jb jc gw bt"><span id="e35c" class="fc jd je ef iw b jf jg jh s ji" data-selectable-paragraph="">- name: Docker login      <br>  uses: docker/login-action@v1      <br>  with:        <br>    registry: public.ecr.aws        <br>    username: ${{ secrets.AWS_ACCESS_KEY_ID }}        <br>    password: ${{ secrets.AWS_SECRET_ACCESS_KEY }}      <br>  env:        <br>  AWS_REGION: us-east-1</span></pre><p id="f01f" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">Before saving your changes, create GitHub secret for <code class="is it iu iv iw b">AWS_ACCESS_KEY_ID</code> and <code class="is it iu iv iw b">AWS_SECRET_ACCESS_KEY</code>. Please refer to <a class="ck ir" href="https://docs.github.com/en/actions/reference/encrypted-secrets" rel="noopener ugc nofollow" target="_blank">https://docs.github.com/en/actions/reference/encrypted-secrets</a> if you’re unfamiliar with how to create GitHub secrets. When you save the changes <code class="is it iu iv iw b">main.yml</code> it will trigger workflow that will build and push your image to your registry.</p><p id="c567" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">Next, create a configuration file called <code class="is it iu iv iw b">kind-eks-d-v1.20.conf</code> for KinD that looks similar to the following:</p><pre class="ix iy iz ja jb jc gw bt"><span id="b2ed" class="fc jd je ef iw b jf jg jh s ji" data-selectable-paragraph="">kind: Cluster<br>apiVersion: kind.x-k8s.io/v1alpha4<br>name: eks-d-1-20<br>nodes:<br>- role: control-plane<br>  image: public.ecr.aws/jicowan/kind-eks-d:4e13a3f38c26a14e6a333fc7b8246c02ac4b33b2<br>- role: worker<br>  image: public.ecr.aws/jicowan/kind-eks-d:4e13a3f38c26a14e6a333fc7b8246c02ac4b33b2</span></pre><p id="33c1" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">Be aware you may need to update the image with the URI of your image, although you’re free to use the image that I pushed to ECR public.</p><p id="b6ca" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">Finally, create a KinD cluster by executing the following command:</p><pre class="ix iy iz ja jb jc gw bt"><span id="a3d2" class="fc jd je ef iw b jf jg jh s ji" data-selectable-paragraph="">kind create cluster --config ./kind-eks-d-v1.20.conf</span></pre><p id="bc7a" class="ht hu ef hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq do fc" data-selectable-paragraph="">In about 3–5m you’ll have an EKS-D cluster running on your local machine!</p></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on Jan 29, 2022</p><div class="post__tag"><ul><li><strong>Tagged in:</strong></li><li><a href="https://www.clouday.dev/eks/">EKS</a></li><li><a href="https://www.clouday.dev/kubernetes/">Kubernetes</a></li></ul></div><div class="post__bio"><img src="https://www.gravatar.com/avatar/f9bb8b993116996cdc108516ef1a5022?s&#x3D;240" loading="lazy" alt="Toyhoshi"><div><h3><a href="https://www.clouday.dev/authors/toyhoshi/" class="invert" rel="author">Toyhoshi</a></h3><p>I&#x27;m Marco Varagnolo aka Toyhoshi, the author behind Clouday.dev, curious about everything by nature, i&#x27;m a system architect. Huge supporter of DevOps mindset. My hands are dirty all day long with Kubernetes, containers and many similar things in between. What else do you need? :-)</p></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><div id="search" class="alt"><form action="https://www.clouday.dev/search.html"><input type="text" name="q" placeholder="search..." aria-label="Search"></form></div><nav id="menu"><header class="major"><h2>Menu</h2></header><ul><li><a href="https://www.clouday.dev/" target="_self">Home</a></li><li class="has-submenu"><span aria-haspopup="true" class="opener">Categories</span><ul class="submenu level-2" aria-hidden="true"><li><a href="https://www.clouday.dev/iac/" title="Infrastructure as code" target="_self">IaC</a></li><li><a href="https://www.clouday.dev/ecs/" title="Elastic Container Service" target="_self">ECS</a></li></ul></li></ul></nav><footer id="footer"><p><a class="twitter-timeline" data-dnt="true" data-chrome="transparent,nofooter" data-link-color="#ffcc00" data-tweet-limit="1" href="https://twitter.com/learnk8s">Kubernetes Journey</a><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><img src="https://www.clouday.dev/media/files/LogoCloudayBar.png" alt="www.clouday.dev" width="100%" align="middle"></p></footer></div></div></div><script src="https://www.clouday.dev/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://www.clouday.dev/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://www.clouday.dev/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://www.clouday.dev/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://www.clouday.dev/assets/js/main.min.js?v=448f4c9d4b4c374766a1cb76c3d88048"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script></body></html>